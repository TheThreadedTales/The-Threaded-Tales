<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Threaded Tales - Category</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .marquee { display:inline-block; white-space:nowrap; animation:scroll 12s linear infinite;}
    @keyframes scroll { 0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
    .zoom:hover { transform: scale(1.2); }
  </style>
</head>
<body class="bg-gray-50">

  <!-- âœ… Launch Offer Banner -->
  <div class="fixed top-0 left-0 w-full bg-black text-yellow-400 z-50 overflow-hidden py-2">
    <div class="marquee font-semibold text-lg">
      ðŸŽ‰ Launch Offer: Flat 50% Off on All Products for a Limited Time! ðŸŽ‰ &nbsp; ðŸŽ‰ Shop Now & Save Big! ðŸŽ‰
    </div>
  </div>

  <!-- âœ… Navbar -->
  <nav class="bg-white shadow-md fixed top-10 w-full z-40">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="index.html" class="text-xl font-bold">The Threaded Tales</a>
      <button id="open-cart" class="relative bg-gray-200 px-4 py-2 rounded-lg">
        ðŸ›’ <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs px-1 rounded-full hidden">0</span>
      </button>
    </div>
  </nav>

  <!-- âœ… Category Title -->
  <div class="pt-28 text-center">
    <h1 id="category-title" class="text-3xl font-bold mb-6"></h1>
  </div>

  <!-- âœ… Product Grid -->
  <section class="max-w-7xl mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="category-products">
    <!-- Products load here -->
  </section>

  <!-- âœ… Product Details Modal -->
  <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-3xl relative">
      <button id="close-modal" class="absolute top-2 right-2 text-gray-700 text-2xl">&times;</button>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <img id="modal-main-img" src="" class="w-full h-80 object-cover rounded-lg zoom cursor-pointer" />
          <div id="modal-thumbnails" class="flex gap-2 mt-2"></div>
        </div>
        <div>
          <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
          <p id="modal-price" class="text-xl text-red-600 mb-2"></p>
          <ul id="modal-description" class="list-disc list-inside mb-4 text-gray-700"></ul>
          <div class="flex items-center mb-4">
            <button id="qty-minus" class="px-2 bg-gray-200">-</button>
            <span id="qty" class="px-4">1</span>
            <button id="qty-plus" class="px-2 bg-gray-200">+</button>
          </div>
          <button id="add-to-cart" class="bg-yellow-500 text-white px-4 py-2 rounded-lg">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Cart Modal -->
  <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md relative">
      <button id="close-cart" class="absolute top-2 right-2 text-gray-800 text-xl">&times;</button>
      <h2 class="text-xl font-bold mb-4">Your Cart</h2>
      <div id="cart-items" class="space-y-3"></div>
      <p class="font-bold mt-4">Total: â‚¹<span id="cart-total">0</span></p>
      <button id="checkout" class="bg-green-600 text-white px-4 py-2 rounded-lg mt-4 w-full">Checkout via WhatsApp</button>
    </div>
  </div>

  <script>
    // âœ… Load Products JSON
    let products = [];
    fetch("handloom_products.json").then(res=>res.json()).then(data=>{ products = data; renderCategoryProducts(); });

    // âœ… Get category from URL
    const params = new URLSearchParams(window.location.search);
    let category = decodeURIComponent(params.get("category") || "").replace("&&","&").trim();

    document.getElementById("category-title").textContent = category;

    // âœ… Render category products
    function renderCategoryProducts(){
      const container = document.getElementById("category-products");
      container.innerHTML = "";
      const filtered = products.filter(p => p.category === category);
      filtered.forEach(p=>{
        const discountPrice = Math.round(p.price * 0.5);
        container.innerHTML += `
          <div class="bg-white rounded-lg shadow-md p-4">
            <img src="${p.images[0]}" class="w-full h-40 object-cover rounded-lg mb-2">
            <h3 class="font-bold">${p.name}</h3>
            <p class="text-red-600 font-semibold">â‚¹${discountPrice} <span class="line-through text-gray-500 text-sm">â‚¹${p.price}</span></p>
            <div class="mt-2 flex gap-2">
              <button onclick="openProductModal(${p.id})" class="bg-blue-500 text-white px-3 py-1 rounded">View</button>
              <button onclick="addProductToCart(${p.id},1)" class="bg-yellow-500 text-white px-3 py-1 rounded">Add to Cart</button>
            </div>
          </div>
        `;
      });
    }

    // âœ… Product Modal
    let currentProduct = null, qty=1;
    function openProductModal(id){
      currentProduct = products.find(p=>p.id===id);
      qty=1;
      document.getElementById("qty").textContent=qty;
      document.getElementById("modal-title").textContent=currentProduct.name;
      document.getElementById("modal-price").innerHTML=`â‚¹${Math.round(currentProduct.price*0.5)} <span class="line-through text-gray-500">â‚¹${currentProduct.price}</span>`;
      document.getElementById("modal-description").innerHTML=currentProduct.description.split(".").map(d=>d?`<li>${d.trim()}</li>`:"").join("");
      document.getElementById("modal-main-img").src=currentProduct.images[0];
      const thumbs=document.getElementById("modal-thumbnails"); thumbs.innerHTML="";
      currentProduct.images.forEach(img=>{ thumbs.innerHTML+=`<img src="${img}" onclick="document.getElementById('modal-main-img').src='${img}'" class="w-12 h-12 object-cover cursor-pointer border">`;});
      document.getElementById("product-modal").classList.remove("hidden");
    }
    document.getElementById("close-modal").onclick=()=>document.getElementById("product-modal").classList.add("hidden");
    document.getElementById("qty-minus").onclick=()=>{if(qty>1)qty--;document.getElementById("qty").textContent=qty;}
    document.getElementById("qty-plus").onclick=()=>{qty++;document.getElementById("qty").textContent=qty;}
    document.getElementById("add-to-cart").onclick=()=>{addProductToCart(currentProduct.id,qty);document.getElementById("product-modal").classList.add("hidden");};

    // âœ… Cart Functions
    let cart=[];
    function addProductToCart(id,quantity){
      const prod=products.find(p=>p.id===id);
      const existing=cart.find(i=>i.id===id);
      if(existing){existing.qty+=quantity;}else{cart.push({id:prod.id,name:prod.name,price:Math.round(prod.price*0.5),qty:quantity});}
      updateCart();
      document.getElementById("cart-modal").classList.remove("hidden");
    }
    function updateCart(){
      const container=document.getElementById("cart-items"); container.innerHTML="";
      let total=0;
      cart.forEach(item=>{
        total+=item.price*item.qty;
        container.innerHTML+=`
          <div class="flex justify-between items-center">
            <span>${item.name} (x${item.qty})</span>
            <span>â‚¹${item.price*item.qty}</span>
          </div>
        `;
      });
      document.getElementById("cart-total").textContent=total;
      document.getElementById("cart-count").textContent=cart.reduce((a,c)=>a+c.qty,0);
      document.getElementById("cart-count").classList.remove("hidden");
    }
    document.getElementById("open-cart").onclick=()=>document.getElementById("cart-modal").classList.remove("hidden");
    document.getElementById("close-cart").onclick=()=>document.getElementById("cart-modal").classList.add("hidden");
    document.getElementById("checkout").onclick=()=>{
      let text="Hi Threaded Tales, I want to order:\n";
      cart.forEach(item=>{text+=`${item.name} x${item.qty} = â‚¹${item.price*item.qty}\n`;});
      text+=`Total: â‚¹${document.getElementById("cart-total").textContent}`;
      window.open("https://wa.me/919671850555?text="+encodeURIComponent(text));
    }
  </script>
</body>
</html>
